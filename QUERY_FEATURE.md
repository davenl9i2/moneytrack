# 聊天查詢功能說明

## 🎉 新功能：智能查詢

現在您的 LINE Bot 不僅可以記帳，還可以回答關於您消費記錄的問題！

## 📝 支援的功能

### 1. **記帳 (RECORD)**
原有功能，輸入消費或收入資訊：
- `午餐 100`
- `薪水 50000`
- `買書 350`

### 2. **查詢 (QUERY)** ✨ 新功能
詢問歷史消費記錄：
- `我昨天花多少錢?`
- `這個月的支出是多少?`
- `上週的交通費`
- `本月收入多少?`
- `最近一週花了多少?`

### 3. **聊天 (CHAT)**
一般對話：
- `你好`
- `謝謝`
- `幫助`

## 🔍 查詢回覆格式

當您詢問消費記錄時，Bot 會回覆：

```
📊 查詢結果

支出總額: $1,250
筆數: 8

主要分類:
飲食: $600
交通: $350
購物: $300
```

## 🧠 智能理解

LLM 會自動：
1. **識別意圖** - 判斷是記帳、查詢還是聊天
2. **解析時間** - 理解「昨天」、「這個月」、「上週」等時間表達
3. **提取類別** - 如果問「交通費」，只統計交通類別
4. **區分類型** - 自動判斷是查詢支出還是收入

## 🛠️ 技術實作

### API 端點
- `GET /api/expenses/stats` - 統計查詢 API
  - 參數：`userId`, `startDate`, `endDate`, `type`
  - 回傳：總額、筆數、分類統計

### LLM 處理流程
1. 使用 Groq (Llama 3.3) 解析使用者訊息
2. 識別 intent: `RECORD` | `QUERY` | `CHAT`
3. 對於 QUERY：
   - 解析時間範圍 → `queryStartDate`, `queryEndDate`
   - 識別查詢類型 → `queryType`: `EXPENSE` | `INCOME` | `ALL`
   - 提取分類 → `category` (如果有指定)
4. 查詢資料庫並回傳統計結果

## 📊 查詢範例

| 使用者輸入 | LLM 解析 | 查詢條件 |
|-----------|---------|---------|
| 我昨天花多少錢? | QUERY | startDate: 2025-12-05<br>endDate: 2025-12-05<br>type: EXPENSE |
| 這個月的交通費 | QUERY | startDate: 2025-12-01<br>endDate: 2025-12-31<br>type: EXPENSE<br>category: 交通 |
| 本月收入 | QUERY | startDate: 2025-12-01<br>endDate: 2025-12-31<br>type: INCOME |

## 🚀 下一步優化建議

1. **圖表視覺化** - 在 Web 介面顯示查詢結果的圖表
2. **更多統計** - 平均值、趨勢分析、同比增長
3. **預算提醒** - 「本月已花 80% 預算」
4. **智能建議** - 「您的交通費比上月高 20%」
5. **匯出報表** - 產生 PDF 或 Excel 報表
